# Story 2.1: Create API Journey Animation Component

**Epic:** 2 - API Journey Visualization  
**Status:** Draft  
**Story Points:** 3  
**Priority:** High  
**Created:** 2025-10-27  
**Updated:** 2025-10-27  

---

## User Story

**As a** developer,  
**I want** to create a reusable ApiJourneyAnimation component,  
**so that** I can display multi-stage progress with animations.

---

## Story Description

Build the core animation component with three stages (location lookup, weather fetch, complete), horizontal layout, icon-based visualization, and smooth transitions. Component should be state-driven and accept progress updates.

This component will replace the existing `LoadingSpinner` and provide educational visual feedback showing the sequential API calls (geocoding ‚Üí weather).

---

## Acceptance Criteria

1. ‚úÖ Component accepts three stages: `geocoding`, `weather`, `complete`
2. ‚úÖ Component displays horizontal progress path with icons
3. ‚úÖ Component shows user-friendly labels (no technical jargon)
4. ‚úÖ Component uses smooth CSS animations for transitions
5. ‚úÖ Component has `show()` and `hide()` methods matching LoadingSpinner API
6. ‚úÖ Component includes `updateStage(stage: string)` method for progress updates
7. ‚úÖ Component respects `prefers-reduced-motion` for accessibility
8. ‚úÖ Component includes ARIA attributes for screen readers
9. ‚úÖ Component has TypeScript type definitions
10. ‚úÖ Component includes unit tests
11. ‚úÖ Component follows existing component patterns (class-based, vanilla JS/TS)

---

## Dev Notes

### Previous Story Insights
[Source: Story 1.5 completion - Error Handling and User Feedback]
- Use class-based component architecture with TypeScript
- Include `data-testid` attributes for testing
- Initialize as hidden, expose show/hide methods
- Use CSS animations for smooth transitions
- Include accessibility attributes (role, aria-live, aria-label)

### Component Architecture
[Source: docs/architecture/high-level-architecture.md]
- Follow component-based UI pattern with clean separation of concerns
- Component should be state-driven and accept updates via methods
- Use vanilla TypeScript class (no framework dependencies)

[Source: docs/architecture/project-structure.md]
- Create file: `src/components/ApiJourneyAnimation.ts`
- Create styles: `src/styles/api-journey.css` (or add to existing `components.css`)
- Create tests: `tests/unit/components/api-journey-animation.test.ts`

### Data Models

**Stage State Type:**
```typescript
type JourneyStage = 'idle' | 'geocoding' | 'weather' | 'complete';
```

**Stage Configuration:**
```typescript
interface StageConfig {
  stage: JourneyStage;
  label: string;
  icon: string;
  ariaLabel: string;
}
```

[Source: Epic 2 requirements]

### Component Specifications

**Public API:**
- `constructor(container: HTMLElement)` - Initialize component
- `show(): void` - Make animation visible
- `hide(): void` - Hide animation
- `updateStage(stage: JourneyStage): void` - Update to next stage
- `reset(): void` - Reset to initial state
- `isShowing(): boolean` - Check visibility state

**Visual Layout (Horizontal):**
```
[üìç Zip Code] ‚îÄ‚îÄ‚Üí [üó∫Ô∏è Finding Location] ‚îÄ‚îÄ‚Üí [‚òÅÔ∏è Getting Weather] ‚îÄ‚îÄ‚Üí [‚úÖ Complete]
   idle             geocoding                 weather               complete
```

**User-Friendly Labels:**
- Stage 1 (geocoding): "Looking up your location..."
- Stage 2 (weather): "Getting weather data..."
- Stage 3 (complete): "Complete!" (brief, then hide)

[Source: docs/brainstorming-session-results.md, Epic 2]

### File Locations

**Component File:**
- Path: `src/components/ApiJourneyAnimation.ts`
- Naming: PascalCase class name `ApiJourneyAnimation`

**Style File:**
- Path: `src/styles/api-journey.css`
- Or add to: `src/styles/components.css`

**Test File:**
- Path: `tests/unit/components/api-journey-animation.test.ts`

[Source: docs/architecture/project-structure.md, docs/architecture/coding-standards.md]

### Testing Requirements

[Source: docs/architecture/testing-strategy.md]

**Unit Tests Required:**
- Component initializes hidden
- `show()` makes component visible
- `hide()` hides component
- `updateStage()` transitions to correct stage
- Stage labels display correctly
- Icons display for each stage
- `prefers-reduced-motion` disables animations
- ARIA attributes are set correctly
- `data-testid` attributes present for testing

**Test Framework:** Vitest with jsdom

### Technical Constraints

[Source: docs/architecture/coding-standards.md]
- **TypeScript Strict Mode:** All functions must have type annotations
- **Component Data Attributes:** Include `data-testid` for all interactive/testable elements
- **No Hardcoded Values:** Use constants for timing, labels, icons
- **Naming Conventions:**
  - File: `api-journey-animation.ts` (kebab-case)
  - Class: `ApiJourneyAnimation` (PascalCase)
  - Methods: `updateStage()` (camelCase)
  - CSS classes: `api-journey__stage` (BEM, kebab-case)

[Source: docs/architecture/tech-stack.md]
- **No external animation libraries** - Use CSS animations only
- **Icons:** Use emojis or inline SVG (keep it simple, no icon libraries)
- **Build Tool:** Must work with Vite build system
- **Browser Support:** Modern browsers (ES2022+)

### Styling Approach

[Source: docs/architecture/tech-stack.md - Tailwind CSS ^3.4]
- Use Tailwind utilities where applicable
- Custom animations in CSS for smooth transitions
- Responsive design (works on mobile, tablet, desktop)
- Follows existing component styling patterns

[Source: docs/architecture/coding-standards.md]
- CSS class naming: BEM methodology with kebab-case
- Example: `.api-journey`, `.api-journey__stage`, `.api-journey__stage--active`

### Accessibility Requirements

[Source: docs/architecture/coding-standards.md, Epic 2 requirements]
- **ARIA Attributes:**
  - `role="status"` - Announce status changes
  - `aria-live="polite"` - Screen reader updates
  - `aria-label` - Descriptive labels for each stage
- **Reduced Motion:**
  - Detect `prefers-reduced-motion: reduce`
  - Disable or simplify animations accordingly
  - Instant transitions instead of animated ones

### Animation Timing

[Source: Epic 2 - Deliberate educational pace]
- **Minimum stage duration:** 1.5 seconds per stage
- **Transition duration:** 0.5 seconds between stages
- **Total ideal time:** 3-4 seconds for complete journey
- **Strategy:** Hold stage display even if API completes faster (educational value)

### Performance Considerations

[Source: docs/architecture/tech-stack.md, Epic 2 risk mitigation]
- Use CSS transforms and opacity for animations (GPU-accelerated)
- Avoid layout thrashing (use transform, not position changes)
- Clean up event listeners and timers on hide/reset
- Test on mobile devices for smooth performance

---

## Tasks / Subtasks

### Task 1: Create Component File Structure (AC: 1, 9, 11)
[Source: project-structure.md, coding-standards.md]
- [ ] Create `src/components/ApiJourneyAnimation.ts`
- [ ] Define `JourneyStage` type: `'idle' | 'geocoding' | 'weather' | 'complete'`
- [ ] Define `StageConfig` interface with label, icon, ariaLabel
- [ ] Create class `ApiJourneyAnimation` with TypeScript strict mode
- [ ] Add private properties: `container`, `element`, `currentStage`, `isVisible`
- [ ] Implement constructor accepting `container: HTMLElement`

### Task 2: Implement Core Component Methods (AC: 5, 6)
[Source: LoadingSpinner.ts pattern, Epic 2 requirements]
- [ ] Implement `initialize()` method - Create DOM structure
- [ ] Implement `show(): void` - Display animation with fade-in
- [ ] Implement `hide(): void` - Hide animation with fade-out
- [ ] Implement `updateStage(stage: JourneyStage): void` - Transition to new stage
- [ ] Implement `reset(): void` - Reset to idle state
- [ ] Implement `isShowing(): boolean` - Return visibility state

### Task 3: Build HTML Structure with Icons (AC: 2, 3)
[Source: Epic 2 visual design]
- [ ] Create container div with `api-journey` class
- [ ] Create three stage elements (geocoding, weather, complete)
- [ ] Add icons: üó∫Ô∏è (map) for geocoding, ‚òÅÔ∏è (cloud) for weather, ‚úÖ (checkmark) for complete
- [ ] Add labels: "Looking up your location...", "Getting weather data...", "Complete!"
- [ ] Add connecting path/arrows between stages (visual flow indicators)
- [ ] Include `data-testid` attributes: `api-journey`, `stage-geocoding`, `stage-weather`, `stage-complete`

### Task 4: Add Accessibility Features (AC: 7, 8)
[Source: coding-standards.md, accessibility requirements]
- [ ] Add `role="status"` to container
- [ ] Add `aria-live="polite"` to container
- [ ] Add dynamic `aria-label` that updates with current stage
- [ ] Detect `prefers-reduced-motion` media query
- [ ] Store motion preference in component state
- [ ] Conditionally apply animation classes based on motion preference

### Task 5: Implement CSS Animations (AC: 4)
[Source: Epic 2 timing requirements, performance considerations]
- [ ] Create `src/styles/api-journey.css` file
- [ ] Import into `src/styles/index.css`
- [ ] Style horizontal layout using flexbox
- [ ] Create fade-in/fade-out transitions (0.3s)
- [ ] Create stage activation animation (scale, color, glow)
- [ ] Create path/arrow animations (progress indicator)
- [ ] Add responsive styles for mobile, tablet, desktop
- [ ] Add `prefers-reduced-motion` media query with simplified styles

### Task 6: Stage Transition Logic with Timing (AC: 6)
[Source: Epic 2 timing strategy]
- [ ] Track stage start time with `performance.now()`
- [ ] Implement minimum display time per stage (1.5 seconds)
- [ ] Calculate elapsed time before allowing stage transition
- [ ] If API finishes early, hold current stage until minimum time passes
- [ ] Transition to next stage with smooth animation
- [ ] Update ARIA label when stage changes

### Task 7: Create Unit Tests (AC: 10)
[Source: testing-strategy.md]
- [ ] Create `tests/unit/components/api-journey-animation.test.ts`
- [ ] Setup: Mock DOM environment with jsdom
- [ ] Test: Component initializes hidden (`display: none`)
- [ ] Test: `show()` makes component visible
- [ ] Test: `hide()` hides component after animation
- [ ] Test: `updateStage('geocoding')` activates geocoding stage
- [ ] Test: `updateStage('weather')` transitions to weather stage
- [ ] Test: `updateStage('complete')` shows complete state
- [ ] Test: Stage labels render correctly
- [ ] Test: Icons render for each stage
- [ ] Test: `data-testid` attributes present
- [ ] Test: ARIA attributes set correctly
- [ ] Test: `prefers-reduced-motion` disables animations
- [ ] Test: `reset()` returns to idle state
- [ ] Run tests: `npm run test`

### Task 8: Code Review and Refinement (AC: 1-11)
- [ ] Verify all acceptance criteria met
- [ ] Check TypeScript strict mode compliance
- [ ] Validate naming conventions (file, class, methods, CSS)
- [ ] Ensure no hardcoded values (use constants)
- [ ] Add JSDoc comments for public methods
- [ ] Verify educational value in code clarity
- [ ] Test on different screen sizes
- [ ] Verify smooth performance (no jank)

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Code follows TypeScript strict mode
- [x] All naming conventions followed (kebab-case files, PascalCase class, camelCase methods)
- [x] Component includes accessibility features (ARIA, reduced motion)
- [x] Component includes `data-testid` attributes for testing
- [x] Unit tests written and passing (Vitest)
- [x] No ESLint errors
- [x] No TypeScript errors
- [x] Code is properly formatted (Prettier)
- [x] JSDoc comments added for public API
- [x] CSS follows BEM naming conventions
- [x] Component matches LoadingSpinner API pattern
- [x] Animations are smooth and performant
- [x] Works on mobile, tablet, desktop
- [x] Git commit with clear message

---

## Dependencies

**Depends On:**
- None (foundation already exists)

**Blocks:**
- Story 2.2 (Integration into main.ts)

---

## Technical Risks

### Risk 1: Animation Performance on Low-End Devices
**Impact:** Medium  
**Mitigation:** Use GPU-accelerated CSS properties (transform, opacity), test on mobile, provide reduced-motion fallback

### Risk 2: Timing Coordination Complexity
**Impact:** Low  
**Mitigation:** Simple setTimeout-based approach, track stage timestamps, well-tested logic

---

## Notes

- This component is designed for **educational value** - the code should be clean and well-commented
- Future enhancement: Could be made generic for other multi-step processes
- Keep it simple: No external libraries, just vanilla TypeScript and CSS
- The horizontal layout may be switched to vertical in future versions if more stages are added

---

## Dev Agent Record

### Implementation Start
*To be filled by Dev Agent when starting implementation*

### Completion Notes
*To be filled by Dev Agent upon completion*

### Debug Log Reference
*To be filled if debugging is required*

